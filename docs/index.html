<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<link rel="stylesheet" href="./mystyle.css">

<title>Hello, world!</title> 

<script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">เมนู</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
            <ul class="navbar-nav flex-grow-1">
                <li class="nav-item">
                    <a class="nav-link text-dark" href="/">สั่งอาหาร</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="container-fluid">
  <div class="row">
      <div class="col-12 col-md-4 col-lg-4 border-end order-2 order-md-1">
          <div>
            <!-- <button onclick="window.print()">Print</button> -->
              <h6>ใบรายการอาหาร</h6>
              <div class="row">
                  <div class="col-6">
                      <div style="display: inline-flex;">
                          <div class="pt-2 me-2">
                              <h6>โต๊ะ</h6>
                          </div>
                          <select class="form-select">
                            <option selected value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                          </select>
                      </div>
                  </div>
                  <div class="col-6">
                      <div class="form-check">
                          <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
                          <label class="form-check-label" for="flexRadioDefault1">
                              ทานที่ร้าน
                          </label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                          <label class="form-check-label" for="flexRadioDefault2">
                              ห่อใส่ถุง
                          </label>
                      </div>
                  </div>
              </div>
          </div>
          <table class="table" id="data_list">
              <thead>
                  <tr>
                      <th></th>
                      <th>รายการ</th>
                      <th class="text-center">จำนวน</th>
                      <th class="text-end">ราคา</th>
                  </tr>
              </thead>
              <tbody>
                  
              </tbody>
              <tfoot>
                  <tr>
                      <td></td>
                      <td colspan="2">รวม</td>
                      <td class="text-end" id="data_list_amount">0</td>
                  </tr>
              </tfoot>
          </table>
          <div class="text-end">
              <button class="btn btn-sm btn-secondary">พิมพ์</button>
              <button class="btn btn-sm btn-success">ยืนยัน</button>
          </div>
      </div>
      <div class="col-12 col-md-8 col-lg-8 order-1 order-md-2">
          <p>
              <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapseMain" role="button" aria-expanded="false" aria-controls="collapseMain">
                  สั่งก๋วยเตี๋ยว
              </a>
          </p>
          <div class="collapse show" id="collapseMain">
              <div>
                  <div>
                      <div class="mb-1">
                          <label class="text-secondary">เลือกเส้น <span class="text-danger">*</span></label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center" id="menu_noodle_1">
                          </div>
                      </div>
                      <div class="mb-1">
                          <label class="text-secondary">เลือกน้ำ <span class="text-danger">*</span></label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center" id="menu_noodle_2">
                          </div>
                      </div>
  
                      <div class="mb-1">
                          <label class="text-secondary">เลือกเนื้อ</label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center" id="menu_noodle_3">
                          </div>
                      </div>
                      <div class="mb-1">
                          <label class="text-secondary">เลือกหมู</label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center" id="menu_noodle_4">
                          </div>
                      </div>
                      <div class="mb-1">
                          <label class="text-secondary">เลือกขนาด</label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center" id="menu_noodle_5">
                          </div>
                      </div>
                      <div class="mb-3">
                          <label class="text-secondary">จำนวน</label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-6 text-center">
                              <div class="col">
                                  <select class="form-select" name="num">
                                      <option selected value="1">1</option>
                                      <option value="2">2</option>
                                      <option value="3">3</option>
                                      <option value="4">4</option>
                                      <option value="5">5</option>
                                      <option value="6">6</option>
                                      <option value="7">7</option>
                                  </select>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div>
                      <div class="alert alert-dark p-2" role="alert">
                          <div class="row justify-content-between">
                              <div class="col">
                                - <label id="menu_noodle_1_name"></label><br />
                                - <label id="menu_noodle_2_name"></label><br />
                                - <label id="menu_noodle_3_name"></label>
                                <label id="menu_noodle_4_name"></label><br />
                                - <label id="menu_noodle_5_name"></label>
                                <br/>
                                  <!-- <label>เล็ก น้ำตก เนื้อรวม พิเศษ</label><br /> -->
                                  <label>จำนวน <label id="num">1</label> รายการ</label><br />
                                  <label>ราคา <label id="sum_amount">0</label></label>
                              </div>
                              <div class="col text-end">
                                  <button class="btn btn-secondary btn-sm" onclick="clearData()">เคลียร์</button>
                                  <button class="btn btn-primary btn-sm" onclick="addToList()">เพิ่ม</button>
<!--                                   @*<button class="btn btn-primary btn-sm">อัพเดต</button>*@ -->
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
  
  
          <p>
              <a hidden class="btn btn-primary" data-bs-toggle="collapse" href="#collapseSub" role="button" aria-expanded="false" aria-controls="collapseSub">
                  อาหารเพิ่มเติม v
              </a>
          </p>
          <div hidden class="collapse show" id="collapseSub">
              <div>
                  <div>
                      <div class="mb-1">
                          <label class="text-secondary">น้ำ</label>
                          <div class="row row-cols-3 row-cols-sm-4 row-cols-md-4 row-cols-lg-5 text-center">
<!--                               @{
                                  string[] sub_name = { "โค๊ก", "แป๊ปซี่", "น้ำเปล่า"};
                                  string[] sub_price = { "+15", "+15", "+10"};
                                  string[] sub_image = {
                      "https://f.ptcdn.info/487/028/000/1424059135-dsc01354-o.jpg",
                      "https://www.simummuangmarket.com/uploads/image-1579659833771.jpg",
                      "https://th-test-11.slatic.net/p/38f7e0d2567de71b6718d2fbe6adcbaa.jpg",
                      "https://cf.shopee.co.th/file/e55a7117d5226ae9cbdb252c1838855f",
                      "https://cf.shopee.co.th/file/e55a7117d5226ae9cbdb252c1838855f",
                      "https://lzd-img-global.slatic.net/g/p/9a0038e0734375070bc55eb442a5097e.jpg_1200x1200q80.jpg_.webp"
                  };
                              }
                              @for (int i = 0; i < sub_name.Length; i++)
                              {
                                  <div class="col">
                                      <div class="card py-1">
                                          @*<div class="mb-1">
                                              <img style="width: -webkit-fill-available; max-height: 90px;" src="@noodles_image[i]" />
                                          </div>*@
                                          <div>
                                              <label class="fs-6">@sub_name[i]</label>
                                          </div>
                                          <div>
                                              <small class="text-secondary">@sub_price[i]</small>
                                          </div>
                                          <div class="px-2">
                                              <div class="input-group mb-3 text-center">
                                                  <span class="input-group-text">-</span>
                                                  <input type="text" class="form-control text-center" aria-label="Amount" value="0">
                                                  <span class="input-group-text">+</span>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              } -->
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<script>
    let dataList = [];
  $(document).ready(function(){
    console.log('hi script')
    ajaxCallPageGet('/api/orders/menu-noodles').then((_data) => {
            if (_data.messageStatus === 'success') {
                console.log('_data', _data);
                let img = '';
                let name = '';
                let price = '';
                let menu_noodle_1 = '';
                let array_data_type = ['radio', 'radio', 'checkbox', 'checkbox', 'radio'];
                let array_data = ['เลือกเส้น', 'เลือกน้ำ', 'เลือกเนื้อ', 'เลือกหมู', 'เลือกขนาด'];
                let array_data_id = ['menu_noodle_1', 'menu_noodle_2', 'menu_noodle_3', 'menu_noodle_4', 'menu_noodle_5'];
                let isChecked = '';
                for(let a in array_data){
                    let data_ = _data.menu_noodles.filter(s=>s.category_th === array_data[a]);
                    menu_noodle_1 = '';
                    for(let i in data_){
                        let d = data_[i];
                        img = d.image_url !== '' ? `<img style="width: -webkit-fill-available; max-height: 90px;" src="`+ d.image_url +`" />` : ``;
                        name = d.name_th;
                        price = d.price;
                        id = d.id;
                        isChecked = '';
                        if(name === 'ธรรมดา'){
                            isChecked = 'checked';
                        }
                        menu_noodle_1 += `<div class="col">
                                            <div class="form-check p-0 position-relative">
                                                <label class="card py-1 mb-2 form-check-label" for="`+ id +`">
                                                    <input `+ isChecked +` class="form-check-input" type="`+ array_data_type[a] +`" name="`+ array_data_id[a] +`" id="`+ id +`" value="`+ id +`" data-name="`+ name +`" data-price="`+ price +`" hidden>
                                                    `+ img +`
                                                    <div>
                                                        <small class="fs-6">`+ name +`</small>
                                                    </div>
                                                    <div>
                                                        <small class="text-secondary">+`+ price +`</small>
                                                    </div>
                                                    <img class="img__checked"src="./checked.png" width="30" />
                                                </label>
                                            </div>
                                        </div>`;
                    }

                    $('#' + array_data_id[a]).empty();
                    $('#' + array_data_id[a]).append(menu_noodle_1);
                }

            } else {
                // showToastsWarningBottomEndFade(_data.messageDescription)
            }
        }).catch((error) => {
            console.log(error)
        }).finally(function () {
            // hideSpinnerBtn(getThis);
        });
  });

  $(document).on('change', 'input[type=radio][name=menu_noodle_1]', function (event) {
        getMenuSelected();
  });

  $(document).on('change', 'input[type=radio][name=menu_noodle_2]', function (event) {
        getMenuSelected();
  });
  $(document).on('change', 'input[type=checkbox][name=menu_noodle_3]', function (event) {
        getMenuSelected();
  });
  $(document).on('change', 'input[type=checkbox][name=menu_noodle_4]', function (event) {
        getMenuSelected();
  });
  $(document).on('change', 'input[type=radio][name=menu_noodle_5]', function (event) {
        getMenuSelected();
  });
  $(document).on('change', 'select[name=num]', function (event) {
        getMenuSelected();
  });

  function getMenuSelected(){
    let sum_amount = 0;
    let menu_noodle_1_name = $('input[name="menu_noodle_1"]:checked').attr('data-name');
    $('#menu_noodle_1_name').text(menu_noodle_1_name);
    if(menu_noodle_1_name !== undefined){
        sum_amount += parseInt($('input[name="menu_noodle_1"]:checked').attr('data-price'));
    }

    let menu_noodle_2_name = $('input[name="menu_noodle_2"]:checked').attr('data-name');
    $('#menu_noodle_2_name').text(menu_noodle_2_name);
    if(menu_noodle_2_name !== undefined){
        sum_amount += parseInt($('input[name="menu_noodle_2"]:checked').attr('data-price'));
    }

    let n3 = '';
    $('input[name="menu_noodle_3"]:checked').each(function(){
        n3 += $(this).attr('data-name') + ' ';
        sum_amount += parseInt($(this).attr('data-price'));
    });
    $('#menu_noodle_3_name').text(n3);

    let n4 = '';
    $('input[name="menu_noodle_4"]:checked').each(function(){
        n4 += $(this).attr('data-name') + ' ';
        sum_amount += parseInt($(this).attr('data-price'));
    });
    $('#menu_noodle_4_name').text(n4);

    let menu_noodle_5_name = $('input[name="menu_noodle_5"]:checked').attr('data-name');
    $('#menu_noodle_5_name').text(menu_noodle_5_name);
    if(menu_noodle_5_name !== undefined){
        sum_amount += parseInt($('input[name="menu_noodle_5"]:checked').attr('data-price'));
    }

    $('#num').text($('select[name="num"]').val());

    sum_amount = sum_amount * parseInt($('select[name="num"]').val())

    console.log('sum_amount', sum_amount)
    $('#sum_amount').text(sum_amount);
  }

  function addToList(){
    let menu_name = $('#menu_noodle_1_name').text() +' / '+ $('#menu_noodle_2_name').text();
    let menu_name2 = $('#menu_noodle_3_name').text() +' '+ $('#menu_noodle_4_name').text();
    let menu_name3 = $('#menu_noodle_5_name').text();
    let menu_name4 = $('#num').text();
    let menu_name5 = $('#sum_amount').text();
    dataList.push(
        {
            id: dataList.length+1,
            key1: menu_name,
            key2: menu_name2,
            key3: menu_name3,
            num: menu_name4,
            sum_amount: menu_name5
        }
    );
    console.log('dataList', dataList)
    setDataList()
  }

  function remove(getThis, id){
    $(getThis).parent().remove();
    dataList = dataList.filter(function( obj ) {
        return obj.id !== id;
    });
    setDataList()
  }

  function setDataList(){
    let sum_amount = 0;
    let txt = '';
    for(let i in dataList){
        console.log(dataList[i])
        txt += `<tr>
                      <td class="pe-0" onclick="remove(this,`+dataList[i].id+`)"><button class="btn-close btn-sm p-0"></button></td>
                      <td>`+dataList[i].key1+`<br/>`+dataList[i].key2+`<br/>`+dataList[i].key3+`</td>
                      <td class="text-center">`+dataList[i].num+`</td>
                      <td class="text-end">`+dataList[i].sum_amount+`</td>
                  </tr>`;

                  sum_amount += parseInt(dataList[i].sum_amount);
    }
    $('#data_list tbody').empty();
    $('#data_list tbody').append(txt);

    $('#data_list_amount').text(sum_amount);
    
  }

  function clearData(){
    console.log('clear')
    $("input[type=radio]").each(function(){
        $(this).prop('checked', false);
    }); 
    $("input[type=checkbox]").prop('checked', false); 
    $('#menu_noodle_1_name').text('');
    $('#menu_noodle_2_name').text('');
    $('#menu_noodle_3_name').text('');
    $('#menu_noodle_4_name').text('');
    $('#menu_noodle_5_name').text('');
    $('select[name="num"]').val(1)
    $('#num').text('1');
    $('#sum_amount').text('0');
  }

  function ajaxCallPageGet(url) {
    return new Promise((resolve, reject) => {
        $.ajax({
            url: 'https://api.letjoys.com' + url,
            type: 'GET',
            headers: {
                'Content-Type': 'application/json; charset=utf-8',
                //'apiKey': apiKey,
                //'Authorization': 'Bearer ' 
            },
            success: function (data) {
                resolve(data);
            },
            error: function (error) {
                reject(error);
            },
        });
    });
}
</script>
